<?php
// Konfiguracja bazy danych
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "vistula_airlines";

// Połączenie z bazą danych
$conn = new mysqli($servername, $username, $password, $dbname);

// Sprawdzenie połączenia
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// Tworzenie tabel jeśli nie istnieją
$sql = "CREATE TABLE IF NOT EXISTS flights (
    id INT AUTO_INCREMENT PRIMARY KEY,
    flight_number VARCHAR(20) NOT NULL,
    departure_airport VARCHAR(100) NOT NULL,
    arrival_airport VARCHAR(100) NOT NULL,
    departure_datetime DATETIME NOT NULL,
    arrival_datetime DATETIME NOT NULL,
    price_economy DECIMAL(10,2) NOT NULL,
    price_business DECIMAL(10,2) NOT NULL,
    available_seats_economy INT NOT NULL,
    available_seats_business INT NOT NULL,
    aircraft_type VARCHAR(50) NOT NULL
)";

if (!$conn->query($sql)) {
    echo "Error creating table: " . $conn->error;
}

$sql = "CREATE TABLE IF NOT EXISTS bookings (
    id INT AUTO_INCREMENT PRIMARY KEY,
    flight_id INT NOT NULL,
    passenger_name VARCHAR(100) NOT NULL,
    passenger_email VARCHAR(100) NOT NULL,
    passenger_phone VARCHAR(20) NOT NULL,
    seats INT NOT NULL,
    travel_class VARCHAR(20) NOT NULL,
    booking_reference VARCHAR(20) NOT NULL,
    booking_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (flight_id) REFERENCES flights(id)
)";

if (!$conn->query($sql)) {
    echo "Error creating table: " . $conn->error;
}

// Funkcje pomocnicze
function generateBookingReference() {
    return 'VA-' . strtoupper(substr(md5(uniqid()), 0, 6));
}

// Logika aplikacji
$page = isset($_GET['page']) ? $_GET['page'] : 'search';

// Dodawanie przykładowych lotów Vistula Airlines jeśli tabela jest pusta
$result = $conn->query("SELECT COUNT(*) as count FROM flights");
$row = $result->fetch_assoc();
if ($row['count'] == 0) {
    $sample_flights = [
        ['VA101', 'Warsaw (WAW)', 'London (LHR)', date('Y-m-d H:i:s', strtotime('+2 days 08:00')), date('Y-m-d H:i:s', strtotime('+2 days 10:00')), 349.99, 699.99, 120, 24, 'Embraer E195'],
        ['VA202', 'Warsaw (WAW)', 'Paris (CDG)', date('Y-m-d H:i:s', strtotime('+3 days 10:30')), date('Y-m-d H:i:s', strtotime('+3 days 12:45')), 399.99, 799.99, 110, 20, 'Boeing 737'],
        ['VA303', 'Warsaw (WAW)', 'Rome (FCO)', date('Y-m-d H:i:s', strtotime('+4 days 14:15')), date('Y-m-d H:i:s', strtotime('+4 days 16:45')), 449.99, 899.99, 100, 16, 'Airbus A320'],
        ['VA404', 'London (LHR)', 'Warsaw (WAW)', date('Y-m-d H:i:s', strtotime('+5 days 18:00')), date('Y-m-d H:i:s', strtotime('+5 days 20:30')), 379.99, 759.99, 115, 22, 'Embraer E195']
    ];
    
    foreach ($sample_flights as $flight) {
        $stmt = $conn->prepare("INSERT INTO flights (flight_number, departure_airport, arrival_airport, departure_datetime, arrival_datetime, price_economy, price_business, available_seats_economy, available_seats_business, aircraft_type) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
        $stmt->bind_param("sssssddiis", $flight[0], $flight[1], $flight[2], $flight[3], $flight[4], $flight[5], $flight[6], $flight[7], $flight[8], $flight[9]);
        $stmt->execute();
    }
}
?>
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vistula Airlines - Rezerwacja lotów</title>
    <style>
        :root {
            --primary-color: #006994; /* Głęboki morski niebieski */
            --secondary-color: #4da6c4; /* Jasny morski niebieski */
            --accent-color: #e6f2f7; /* Bardzo jasny odcień morski */
            --white: #ffffff;
            --light-gray: #f5f5f5;
            --dark-gray: #333333;
        }
        
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Nagłówek */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo img {
            height: 50px;
            margin-right: 15px;
        }
        
        .logo h1 {
            font-size: 28px;
            font-weight: 700;
        }
        
        .logo span {
            font-size: 14px;
            display: block;
            font-weight: 300;
            margin-top: 3px;
        }
        
        /* Nawigacja */
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }
        
        nav ul li a:hover {
            opacity: 0.8;
        }
        
        /* Formularz wyszukiwania */
        .search-section {
            background-color: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            margin: 30px 0;
            position: relative;
            top: -20px;
        }
        
        .search-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .form-group input, 
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .form-group input:focus, 
        .form-group select:focus {
            border-color: var(--secondary-color);
            outline: none;
        }
        
        .search-button {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 14px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            grid-column: 1 / -1;
            margin-top: 10px;
        }
        
        .search-button:hover {
            background-color: #005a82;
        }
        
        /* Lista lotów */
        .flights-list {
            margin: 40px 0;
        }
        
        .flight-card {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .flight-header {
            background-color: var(--accent-color);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .flight-number {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 18px;
        }
        
        .flight-aircraft {
            color: var(--dark-gray);
            font-size: 14px;
        }
        
        .flight-details {
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            padding: 20px;
        }
        
        .flight-time {
            text-align: center;
        }
        
        .flight-time .time {
            font-size: 24px;
            font-weight: 600;
        }
        
        .flight-time .date {
            color: #666;
            font-size: 14px;
        }
        
        .flight-time .airport {
            font-weight: 600;
            margin-top: 5px;
        }
        
        .flight-duration {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .flight-duration .duration {
            margin: 5px 0;
        }
        
        .flight-prices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 20px;
            background-color: var(--light-gray);
        }
        
        .price-option {
            background-color: var(--white);
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }
        
        .price-option h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .price {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .price-option button {
            background-color: var(--secondary-color);
            color: var(--white);
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        .price-option button:hover {
            background-color: #3b92b0;
        }
        
        /* Formularz rezerwacji */
        .booking-form {
            background-color: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            margin: 30px 0;
        }
        
        .booking-form h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .booking-summary {
            background-color: var(--accent-color);
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
        }
        
        .passenger-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row {
            margin-bottom: 20px;
        }
        
        .submit-button {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .submit-button:hover {
            background-color: #005a82;
        }
        
        /* Potwierdzenie rezerwacji */
        .confirmation {
            text-align: center;
            padding: 50px 20px;
        }
        
        .confirmation-icon {
            color: #4CAF50;
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .confirmation h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .confirmation-code {
            background-color: var(--accent-color);
            display: inline-block;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 700;
            margin: 20px 0;
            color: var(--primary-color);
        }
        
        /* Stopka */
        footer {
            background-color: var(--dark-gray);
            color: var(--white);
            padding: 30px 0;
            margin-top: 50px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }
        
        .footer-column h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .footer-column ul {
            list-style: none;
        }
        
        .footer-column ul li {
            margin-bottom: 10px;
        }
        
        .footer-column ul li a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-column ul li a:hover {
            color: var(--white);
        }
        
        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #444;
            color: #999;
            font-size: 14px;
        }
        
        /* Responsywność */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 20px;
                justify-content: center;
            }
            
            .flight-details {
                grid-template-columns: 1fr;
            }
            
            .flight-prices {
                grid-template-columns: 1fr;
            }
            
            .passenger-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <!-- Tutaj możesz dodać logo Vistula Airlines -->
                <h1>Vistula Airlines <span>Podniebne podróże z klasą</span></h1>
            </div>
            <nav>
                <ul>
                    <li><a href="?page=search">Strona główna</a></li>
                    <li><a href="#">O nas</a></li>
                    <li><a href="#">Kontakt</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <?php if ($page == 'search'): ?>
            <!-- Strona wyszukiwania lotów -->
            <section class="search-section">
                <h2 class="search-title">Znajdź idealny lot</h2>
                <form action="?page=results" method="post" class="search-form">
                    <div class="form-group">
                        <label for="departure">Skąd</label>
                        <select id="departure" name="departure" required>
                            <option value="">Wybierz lotnisko</option>
                            <option value="Warsaw (WAW)">Warszawa (WAW)</option>
                            <option value="London (LHR)">Londyn (LHR)</option>
                            <option value="Paris (CDG)">Paryż (CDG)</option>
                            <option value="Rome (FCO)">Rzym (FCO)</option>
                            <option value="Berlin (BER)">Berlin (BER)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="arrival">Dokąd</label>
                        <select id="arrival" name="arrival" required>
                            <option value="">Wybierz lotnisko</option>
                            <option value="Warsaw (WAW)">Warszawa (WAW)</option>
                            <option value="London (LHR)">Londyn (LHR)</option>
                            <option value="Paris (CDG)">Paryż (CDG)</option>
                            <option value="Rome (FCO)">Rzym (FCO)</option>
                            <option value="Berlin (BER)">Berlin (BER)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="departure_date">Data wylotu</label>
                        <input type="date" id="departure_date" name="departure_date" required min="<?php echo date('Y-m-d'); ?>">
                    </div>
                    
                    <div class="form-group">
                        <label for="return_date">Data powrotu (opcjonalnie)</label>
                        <input type="date" id="return_date" name="return_date" min="<?php echo date('Y-m-d'); ?>">
                    </div>
                    
                    <div class="form-group">
                        <label for="passengers">Liczba pasażerów</label>
                        <select id="passengers" name="passengers" required>
                            <option value="1">1 pasażer</option>
                            <option value="2">2 pasażerów</option>
                            <option value="3">3 pasażerów</option>
                            <option value="4">4 pasażerów</option>
                            <option value="5">5 pasażerów</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="class">Klasa podróży</label>
                        <select id="class" name="class" required>
                            <option value="economy">Ekonomiczna</option>
                            <option value="business">Business</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="search-button">Szukaj lotów</button>
                </form>
            </section>
            
            <section class="about-section">
                <h2>Vistula Airlines - Polska jakość w powietrzu</h2>
                <p>Jako wiodąca polska linia lotnicza, oferujemy połączenia do najważniejszych miast w Europie z najwyższą dbałością o komfort i bezpieczeństwo naszych pasażerów.</p>
            </section>

        <?php elseif ($page == 'results' && $_SERVER['REQUEST_METHOD'] == 'POST'): ?>
            <!-- Wyniki wyszukiwania -->
            <?php
            $departure = $_POST['departure'];
            $arrival = $_POST['arrival'];
            $departure_date = $_POST['departure_date'];
            $return_date = $_POST['return_date'];
            $passengers = $_POST['passengers'];
            $class = $_POST['class'];
            
            // Wyszukiwanie lotów w bazie danych
            $sql = "SELECT * FROM flights WHERE departure_airport = ? AND arrival_airport = ? AND DATE(departure_datetime) = ? ORDER BY departure_datetime";
            $stmt = $conn->prepare($sql);
            $stmt->bind_param("sss", $departure, $arrival, $departure_date);
            $stmt->execute();
            $result = $stmt->get_result();
            ?>
            
            <section class="flights-list">
                <h2>Dostępne loty z <?php echo $departure; ?> do <?php echo $arrival; ?></h2>
                <p>Data: <?php echo date('d.m.Y', strtotime($departure_date)); ?> | Pasażerów: <?php echo $passengers; ?> | Klasa: <?php echo $class == 'economy' ? 'Ekonomiczna' : 'Business'; ?></p>
                
                <?php if ($result->num_rows > 0): ?>
                    <?php while ($flight = $result->fetch_assoc()): ?>
                        <div class="flight-card">
                            <div class="flight-header">
                                <span class="flight-number">Vistula Airlines <?php echo $flight['flight_number']; ?></span>
                                <span class="flight-aircraft"><?php echo $flight['aircraft_type']; ?></span>
                            </div>
                            
                            <div class="flight-details">
                                <div class="flight-time">
                                    <div class="time"><?php echo date('H:i', strtotime($flight['departure_datetime'])); ?></div>
                                    <div class="date"><?php echo date('d.m.Y', strtotime($flight['departure_datetime'])); ?></div>
                                    <div class="airport"><?php echo $flight['departure_airport']; ?></div>
                                </div>
                                
                                <div class="flight-duration">
                                    <svg width="100" height="20" viewBox="0 0 100 20" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="10" cy="10" r="5" fill="#006994"/>
                                        <line x1="15" y1="10" x2="85" y2="10" stroke="#006994" stroke-width="2" stroke-dasharray="5,5"/>
                                        <circle cx="90" cy="10" r="5" fill="#006994"/>
                                        <path d="M80,5 L90,10 L80,15 Z" fill="#006994"/>
                                    </svg>
                                    <div class="duration">
                                        <?php 
                                        $departure_time = new DateTime($flight['departure_datetime']);
                                        $arrival_time = new DateTime($flight['arrival_datetime']);
                                        $interval = $departure_time->diff($arrival_time);
                                        echo $interval->format('%h godz. %i min.');
                                        ?>
                                    </div>
                                </div>
                                
                                <div class="flight-time">
                                    <div class="time"><?php echo date('H:i', strtotime($flight['arrival_datetime'])); ?></div>
                                    <div class="date"><?php echo date('d.m.Y', strtotime($flight['arrival_datetime'])); ?></div>
                                    <div class="airport"><?php echo $flight['arrival_airport']; ?></div>
                                </div>
                            </div>
                            
                            <div class="flight-prices">
                                <div class="price-option">
                                    <h3>Klasa ekonomiczna</h3>
                                    <div class="price"><?php echo number_format($flight['price_economy'], 2, ',', ' '); ?> PLN</div>
                                    <p>Dostępnych miejsc: <?php echo $flight['available_seats_economy']; ?></p>
                                    <form action="?page=booking" method="post">
                                        <input type="hidden" name="flight_id" value="<?php echo $flight['id']; ?>">
                                        <input type="hidden" name="class" value="economy">
                                        <input type="hidden" name="passengers" value="<?php echo $passengers; ?>">
                                        <button type="submit">Wybierz</button>
                                    </form>
                                </div>
                                
                                <div class="price-option">
                                    <h3>Klasa business</h3>
                                    <div class="price"><?php echo number_format($flight['price_business'], 2, ',', ' '); ?> PLN</div>
                                    <p>Dostępnych miejsc: <?php echo $flight['available_seats_business']; ?></p>
                                    <form action="?page=booking" method="post">
                                        <input type="hidden" name="flight_id" value="<?php echo $flight['id']; ?>">
                                        <input type="hidden" name="class" value="business">
                                        <input type="hidden" name="passengers" value="<?php echo $passengers; ?>">
                                        <button type="submit">Wybierz</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    <?php endwhile; ?>
                <?php else: ?>
                    <div class="no-flights">
                        <p>Niestety, nie znaleziono dostępnych lotów dla podanych kryteriów.</p>
                        <a href="?page=search" class="search-button">Wróć do wyszukiwania</a>
                    </div>
                <?php endif; ?>
            </section>

        <?php elseif ($page == 'booking' && $_SERVER['REQUEST_METHOD'] == 'POST'): ?>
            <!-- Formularz rezerwacji -->
            <?php
            $flight_id = $_POST['flight_id'];
            $class = $_POST['class'];
            $passengers = $_POST['passengers'];
            
            $sql = "SELECT * FROM flights WHERE id = ?";
            $stmt = $conn->prepare($sql);
            $stmt->bind_param("i", $flight_id);
            $stmt->execute();
            $flight = $stmt->get_result()->fetch_assoc();
            
            $price = $class == 'economy' ? $flight['price_economy'] : $flight['price_business'];
            $total_price = $price * $passengers;
            ?>
            
            <section class="booking-form">
                <h2>Dane pasażera</h2>
                
                <div class="booking-summary">
                    <h3>Podsumowanie lotu</h3>
                    <p><strong>Lot:</strong> Vistula Airlines <?php echo $flight['flight_number']; ?></p>
                    <p><strong>Trasa:</strong> <?php echo $flight['departure_airport']; ?> → <?php echo $flight['arrival_airport']; ?></p>
                    <p><strong>Data:</strong> <?php echo date('d.m.Y H:i', strtotime($flight['departure_datetime'])); ?></p>
                    <p><strong>Klasa:</strong> <?php echo $class == 'economy' ? 'Ekonomiczna' : 'Business'; ?></p>
                    <p><strong>Liczba pasażerów:</strong> <?php echo $passengers; ?></p>
                    <p><strong>Cena całkowita:</strong> <?php echo number_format($total_price, 2, ',', ' '); ?> PLN</p>
                </div>
                
                <form action="?page=confirmation" method="post">
                    <input type="hidden" name="flight_id" value="<?php echo $flight_id; ?>">
                    <input type="hidden" name="class" value="<?php echo $class; ?>">
                    <input type="hidden" name="passengers" value="<?php echo $passengers; ?>">
                    <input type="hidden" name="total_price" value="<?php echo $total_price; ?>">
                    
                    <div class="passenger-details">
                        <div class="form-group">
                            <label for="passenger_name">Imię i nazwisko</label>
                            <input type="text" id="passenger_name" name="passenger_name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="passenger_email">Adres e-mail</label>
                            <input type="email" id="passenger_email" name="passenger_email" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="passenger_phone">Telefon</label>
                            <input type="tel" id="passenger_phone" name="passenger_phone" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <label>
                            <input type="checkbox" name="terms" required> Akceptuję regulamin i politykę prywatności
                        </label>
                    </div>
                    
                    <button type="submit" class="submit-button">Potwierdź rezerwację</button>
                </form>
            </section>

        <?php elseif ($page == 'confirmation' && $_SERVER['REQUEST_METHOD'] == 'POST'): ?>
            <!-- Potwierdzenie rezerwacji -->
            <?php
            $flight_id = $_POST['flight_id'];
            $class = $_POST['class'];
            $passengers = $_POST['passengers'];
            $total_price = $_POST['total_price'];
            $passenger_name = $_POST['passenger_name'];
            $passenger_email = $_POST['passenger_email'];
            $passenger_phone = $_POST['passenger_phone'];
            
            // Pobierz dane lotu
            $sql = "SELECT * FROM flights WHERE id = ?";
            $stmt = $conn->prepare($sql);
            $stmt->bind_param("i", $flight_id);
            $stmt->execute();
            $flight = $stmt->get_result()->fetch_assoc();
            
            // Generuj kod rezerwacji
            $booking_reference = generateBookingReference();
            
            // Zapisz rezerwację do bazy danych
            $stmt = $conn->prepare("INSERT INTO bookings (flight_id, passenger_name, passenger_email, passenger_phone, seats, travel_class, booking_reference) VALUES (?, ?, ?, ?, ?, ?, ?)");
            $stmt->bind_param("isssiss", $flight_id, $passenger_name, $passenger_email, $passenger_phone, $passengers, $class, $booking_reference);
            $stmt->execute();
            
            // Aktualizuj liczbę dostępnych miejsc
            if ($class == 'economy') {
                $sql = "UPDATE flights SET available_seats_economy = available_seats_economy - ? WHERE id = ?";
            } else {
                $sql = "UPDATE flights SET available_seats_business = available_seats_business - ? WHERE id = ?";
            }
            $stmt = $conn->prepare($sql);
            $stmt->bind_param("ii", $passengers, $flight_id);
            $stmt->execute();
            ?>
            
            <section class="confirmation">
                <div class="confirmation-icon">✓</div>
                <h2>Dziękujemy za rezerwację w Vistula Airlines!</h2>
                <p>Twoja rezerwacja została pomyślnie zarejestrowana.</p>
                
                <div class="confirmation-code">
                    Numer rezerwacji: <?php echo $booking_reference; ?>
                </div>
                
                <p>Potwierdzenie rezerwacji zostało wysłane na adres: <strong><?php echo $passenger_email; ?></strong></p>
                
                <h3>Szczegóły lotu</h3>
                <p><strong>Lot:</strong> Vistula Airlines <?php echo $flight['flight_number']; ?></p>
                <p><strong>Trasa:</strong> <?php echo $flight['departure_airport']; ?> → <?php echo $flight['arrival_airport']; ?></p>
                <p><strong>Data:</strong> <?php echo date('d.m.Y H:i', strtotime($flight['departure_datetime'])); ?></p>
                <p><strong>Klasa:</strong> <?php echo $class == 'economy' ? 'Ekonomiczna' : 'Business'; ?></p>
                <p><strong>Liczba pasażerów:</strong> <?php echo $passengers; ?></p>
                <p><strong>Cena całkowita:</strong> <?php echo number_format($total_price, 2, ',', ' '); ?> PLN</p>
                
                <a href="?page=search" class="search-button">Wróć do strony głównej</a>
            </section>
        <?php endif; ?>
    </div>

    <footer>
        <div class="container footer-content">
            <div class="footer-column">
                <h3>Vistula Airlines</h3>
                <ul>
                    <li><a href="#">O nas</a></li>
                    <li><a href="#">Flota</a></li>
                    <li><a href="#">Kariera</a></li>
                    <li><a href="#">Aktualności</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>Informacje</h3>
                <ul>
                    <li><a href="#">Regulamin</a></li>
                    <li><a href="#">Polityka prywatności</a></li>
                    <li><a href="#">Warunki przewozu</a></li>
                    <li><a href="#">FAQ</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>Kontakt</h3>
                <ul>
                    <li>ul. Lotnicza 1, 00-001 Warszawa</li>
                    <li>Tel: +48 22 123 45 67</li>
                    <li>Email: kontakt@vistulaairlines.pl</li>
                </ul>
            </div>
        </div>
        
        <div class="container copyright">
            <p>&copy; 2023 Vistula Airlines. Wszelkie prawa zastrzeżone.</p>
        </div>
    </footer>
</body>
</html>
<?php
$conn->close();
?>