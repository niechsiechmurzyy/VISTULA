<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezerwacja lotów - Vistula Airlines</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        /* ... (pozostawiam niezmienione style) ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- ... (pozostawiam niezmienioną sekcję formularza) ... -->
    </div>

    <!-- ... (pozostawiam niezmienione modale) ... -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/i18n/jquery-ui-i18n.min.js"></script>

    <script>
        // Baza danych lotnisk
        const airports = {
            "Polska": [
                { name: "Warszawa - Okęcie", code: "WAW", city: "Warszawa" },
                { name: "Gdańsk - Rębiechowo", code: "GDN", city: "Gdańsk" }
            ]
        };

        // Baza danych lotów (codzienne)
        const flightDatabase = {
            "Warszawa (WAW)-Gdańsk (GDN)": [
                { number: "VA701", departure: "07:00", arrival: "08:00", price: "179 PLN" },
                { number: "VA703", departure: "15:20", arrival: "16:20", price: "199 PLN" },
                { number: "VA705", departure: "19:25", arrival: "20:25", price: "219 PLN" },
                { number: "VA707", departure: "22:55", arrival: "23:55", price: "189 PLN" }
            ],
            "Gdańsk (GDN)-Warszawa (WAW)": [
                { number: "VA702", departure: "06:00", arrival: "07:00", price: "169 PLN" },
                { number: "VA704", departure: "08:45", arrival: "09:45", price: "179 PLN" },
                { number: "VA706", departure: "17:05", arrival: "18:05", price: "199 PLN" },
                { number: "VA708", departure: "21:10", arrival: "22:10", price: "189 PLN" }
            ]
        };

        // Funkcja normalizująca nazwę lotniska
        function normalizeAirport(airport) {
            const match = airport.match(/(.+?)\s*-\s*.+?\s*\(([A-Z]{3})\)/);
            return match ? `${match[1]} (${match[2]})` : airport;
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Zmienne globalne
            let currentInput = null;

            // Inicjalizacja kalendarza dla daty wylotu
            $("#departureDate").datepicker({
                dateFormat: 'dd.mm.yy',
                minDate: 0,
                maxDate: '+1Y',
                firstDay: 1,
                onSelect: function(dateText, inst) {
                    if ($("#tripType").val() === 'roundtrip') {
                        $("#returnDate").datepicker("option", "minDate", dateText);
                    }
                }
            });

            // Inicjalizacja kalendarza dla daty powrotu
            $("#returnDate").datepicker({
                dateFormat: 'dd.mm.yy',
                minDate: 0,
                maxDate: '+1Y',
                firstDay: 1
            });

            // Ustaw język polski dla kalendarza
            $.datepicker.setDefaults($.datepicker.regional['pl']);

            // Obsługa formularza
            document.getElementById('searchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const from = document.getElementById('from').value;
                const to = document.getElementById('to').value;
                const departureDate = $("#departureDate").val();
                const returnDate = $("#returnDate").val();
                const tripType = document.querySelector('.trip-type-option.active').dataset.type;
                const errorMessage = document.getElementById('errorMessage');
                
                if (!from || !to) {
                    errorMessage.textContent = "Proszę wybrać lotnisko wylotu i przylotu";
                    errorMessage.style.display = 'block';
                    return;
                }
                
                if (from === to) {
                    errorMessage.textContent = "Proszę wybrać różne lotniska wylotu i przylotu";
                    errorMessage.style.display = 'block';
                    return;
                }
                
                if (!departureDate) {
                    errorMessage.textContent = "Proszę wybrać datę wylotu";
                    errorMessage.style.display = 'block';
                    return;
                }
                
                if (tripType === 'roundtrip' && !returnDate) {
                    errorMessage.textContent = "Proszę wybrać datę powrotu";
                    errorMessage.style.display = 'block';
                    return;
                }
                
                errorMessage.style.display = 'none';
                showFlights(from, to, departureDate, tripType);
            });
            
            // Przycisk powrotu
            document.getElementById('backButton').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('searchSection').classList.remove('hidden');
                document.getElementById('resultsSection').classList.add('hidden');
            });
            
            // Obsługa modalnego okna lotnisk
            const airportModal = document.getElementById('airportModal');
            const fromInput = document.getElementById('fromInput');
            const toInput = document.getElementById('toInput');
            
            fromInput.addEventListener('click', function() {
                currentInput = 'from';
                document.getElementById('modalTitle').textContent = 'Wybierz lotnisko wylotu';
                showAirportModal();
            });
            
            toInput.addEventListener('click', function() {
                currentInput = 'to';
                document.getElementById('modalTitle').textContent = 'Wybierz lotnisko przylotu';
                showAirportModal();
            });
            
            document.querySelectorAll('.close').forEach(btn => {
                btn.addEventListener('click', function() {
                    airportModal.style.display = 'none';
                    document.getElementById('travelClassModal').style.display = 'none';
                });
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === airportModal || event.target === document.getElementById('travelClassModal')) {
                    airportModal.style.display = 'none';
                    document.getElementById('travelClassModal').style.display = 'none';
                }
            });
            
            // Wyszukiwanie lotnisk
            document.getElementById('searchAirport').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const airportList = document.getElementById('airportList');
                airportList.innerHTML = '';
                
                for (const country in airports) {
                    const filteredAirports = airports[country].filter(airport => 
                        airport.name.toLowerCase().includes(searchTerm) || 
                        airport.city.toLowerCase().includes(searchTerm) ||
                        airport.code.toLowerCase().includes(searchTerm)
                    );
                    
                    if (filteredAirports.length > 0) {
                        const countryGroup = document.createElement('div');
                        countryGroup.className = 'country-group';
                        countryGroup.textContent = country;
                        airportList.appendChild(countryGroup);
                        
                        filteredAirports.forEach(airport => {
                            const airportItem = document.createElement('div');
                            airportItem.className = 'airport-item';
                            airportItem.innerHTML = `
                                <div><strong>${airport.city}</strong> - ${airport.name}</div>
                                <div class="airport-code">${airport.code}</div>
                            `;
                            
                            airportItem.addEventListener('click', function() {
                                const airportText = `${airport.city} - ${airport.name} (${airport.code})`;
                                if (currentInput === 'from') {
                                    document.getElementById('fromInput').textContent = airportText;
                                    document.getElementById('from').value = airportText;
                                } else if (currentInput === 'to') {
                                    document.getElementById('toInput').textContent = airportText;
                                    document.getElementById('to').value = airportText;
                                }
                                airportModal.style.display = 'none';
                            });
                            
                            airportList.appendChild(airportItem);
                        });
                    }
                }
            });
            
            // ... (pozostawiam resztę kodu bez zmian) ...
        });
        
        function showAirportModal() {
            const modal = document.getElementById('airportModal');
            const airportList = document.getElementById('airportList');
            document.getElementById('searchAirport').value = '';
            airportList.innerHTML = '';
            
            for (const country in airports) {
                const countryGroup = document.createElement('div');
                countryGroup.className = 'country-group';
                countryGroup.textContent = country;
                airportList.appendChild(countryGroup);
                
                airports[country].forEach(airport => {
                    const airportItem = document.createElement('div');
                    airportItem.className = 'airport-item';
                    airportItem.innerHTML = `
                        <div><strong>${airport.city}</strong> - ${airport.name}</div>
                        <div class="airport-code">${airport.code}</div>
                    `;
                    
                    airportItem.addEventListener('click', function() {
                        const airportText = `${airport.city} - ${airport.name} (${airport.code})`;
                        if (currentInput === 'from') {
                            document.getElementById('fromInput').textContent = airportText;
                            document.getElementById('from').value = airportText;
                        } else if (currentInput === 'to') {
                            document.getElementById('toInput').textContent = airportText;
                            document.getElementById('to').value = airportText;
                        }
                        airportModal.style.display = 'none';
                    });
                    
                    airportList.appendChild(airportItem);
                });
            }
            
            modal.style.display = 'block';
        }
        
        // ... (pozostawiam resztę funkcji bez zmian) ...
    </script>
</body>
</html>